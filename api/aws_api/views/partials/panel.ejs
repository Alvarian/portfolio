<div class="col-md-5 m-auto">

	<div class="card card-body">	
		<h2>Panel</h2><a href="" onclick="clearPanel(); return false;">Clear</a>

		<form action="/portal" method="POST" enctype="multipart/form-data" id="panel">
			<!-- title -->
			<div class="form-group">
				<label for="title">Title</label>
				<input name="title" class="form-control" type="text">
			</div>

			<!-- description -->
			<div class="form-group">
				<label for="description">Description</label>
				<textarea name="description" class="form-control" type="text"></textarea>
			</div>

			<!-- option: deployedUrl || gameFile && styleFile(S3) -->
			<div class="form-group" id="type">
				<label for="type">Type</label>
				<select name="type" class="form-control">
					<option disabled selected value> -- select an option -- </option>
					<option value="is_deployed">Web App</option>
					<option value="is_game_file" data-toggle="modal" data-target="#exampleModalCenter">Native App</option>
				</select>
			</div>

			<div class="form-group" id="urlField" style="display: none">
				<label for="type">Type</label>
				<i class="far fa-window-close float-right" onclick="returnSelectDefault()"></i>
				<input name="deployed_url" type="text" class="form-control" placeholder="Deployed URL">
			</div>

			<div class="form-group" id="displayUploads" style="display: none">
				<label for="type">Type</label>
				<i class="far fa-window-close float-right" onclick="returnSelectDefault()"></i>
				<input name="" type="text" class="form-control" disabled>
			</div>

			<!-- git url -->
			<div class="form-group">
				<label for="git_url">Git URL</label>
				<input name="git_url" class="form-control" type="text">
			</div>

			<!-- iconFile(S3) -->
			<div class="form-group" id="icon">
				<label for="icon_file">Icon</label>
				<i class="fas fa-globe float-right" onclick="fillIconUrlField(null)"></i>
				<input name="icon_file" class="form-control" type="file">
			</div>

			<div class="form-group" id="displayIcon" style="display: none">
				<label for="type">Type</label>
				<i class="far fa-window-close float-right" onclick="returnIconFieldDefault()"></i>
				<input name="icon_url" type="text" class="form-control">
			</div>

			<button class="btn btn-primary btn-block" type="submit">Submit</button>
		</form>
	</div>

	<script>
		const panel = $('#panel');
		const type = $('#type');
		const urlField = $('#urlField');
		const displayUploads = $('#displayUploads');


		panel.submit(e => {
			const inputs = panel[0];
			const title = inputs[0].value;
			const description = inputs[1].value;
			const type = inputs[2].value;
			const deployedUrl = inputs[3].value;
			const gitUrl = inputs[5].value;
			const iconFile = inputs[6].value;

			if (panel.attr('action').split('/')[2] === 'delete') return true;
			
			if (!title) {
				alert('no title');
				return false;
			}

			if (!description) {
				alert('no description');
				return false;
			}

			// if (!logic.children()[1].value && !deployedUrl) {
			// 	alert('no native logic or deployed url');
			// 	return false;
			// }

			// if (!gitUrl) {
			// 	alert('no git url');
			// 	return false;
			// }

			// if (!iconFile) {
			// 	alert('no icon file');
			// 	return false;
			// }
		});

		function returnSelectDefault() {
			urlField.css('display', 'none');
			displayUploads.children()[2].value = '';
			displayUploads.css('display', 'none');

			logic.children()[1].value = '';
			logic.css('display', 'block');
			style.children()[1].value = '';
			style.css('display', 'block');

			$('.oldLogicUrl').remove();
			$('.oldStyleUrl').remove();
			fakeModalForm.append(logic);
			fakeModalForm.append(style);

			type.children()[1].value = '';
			type.css('display', 'block');
		}

		function returnIconFieldDefault() {
			$('#icon').children()[2].setAttribute('value', '');
			$('#displayIcon').css('display', 'none');
			$('#displayIcon').children()[2].setAttribute('value', '');

			$('#icon').css('display', 'block');			
		}

		function fillIconUrlField(url) {
			$('#icon').children()[2].setAttribute('value', '');
			$('#icon').css('display', 'none');

			$('#displayIcon').css('display', 'block');
			$('#displayIcon').children()[2].setAttribute('value', (url) ? url : '');
		}

		function changeTypeOption(selectType, fileUrlsFromGallery) {
			const istypeFromGallery = (urlField.children()[2].value) ? 'deployed' : 'game';

			switch (selectType) {
				case 'is_deployed':
					if (panel.attr('action').split('/')[2] === 'update' && istypeFromGallery !== 'deployed') {
						alert('Cannot alter type of already created app, please choose the NATIVE APP option');

						type.children()[1].value = '';

						return;
					}

					type.css('display', 'none');
					urlField.css('display', 'block');

					break;

				case 'is_game_file':
					if (panel.attr('action').split('/')[2] === 'update' && istypeFromGallery !== 'game') {
						alert('Cannot alter type of already created app, please choose the WEB APP option');

						type.children()[1].value = '';

						return;
					};

					if (!fileUrlsFromGallery) {
						$('#exampleModalCenter').modal("show");
						
						return;
					}

				    type.css('display', 'none');

				    const oldLogicUrl = document.createElement('input');
				    oldLogicUrl.setAttribute('type', 'hidden');
				    oldLogicUrl.setAttribute('class', 'oldLogicUrl');
				    oldLogicUrl.setAttribute('name', 'game_file');
				    oldLogicUrl.value = fileUrlsFromGallery.game_file;

					panel.prepend(oldLogicUrl);
				    
				    if (fileUrlsFromGallery.style_file) {
					    const oldStyleUrl = document.createElement('input');
					    oldStyleUrl.setAttribute('type', 'hidden');
					    oldStyleUrl.setAttribute('class', 'oldStyleUrl');
					    oldStyleUrl.setAttribute('name', 'style_file');
					    oldStyleUrl.value = fileUrlsFromGallery.style_file;
					
						panel.prepend(oldStyleUrl);
				    }

					displayUploads.children()[2].value = `Has Logic; ${(!fileUrlsFromGallery.style_file) ? '' : 'Has Style;'}`;
					displayUploads.css('display', 'block');

					break;

				default:
					break;
			}
		}

		type.change(e => changeTypeOption(e.target.value, null));

		function clearPanel() {
			panel.attr('action', '/portal');

			returnSelectDefault();

			panel.trigger('reset');
		}
	</script>
</div>
